<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SalStocks</title>
	<link rel="stylesheet" type="text/css" href="search8.css"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="logout.js"></script>
</head>
<body>
	<header class="site-header">
	  <a href="index.html" onclick="goLogout()" class="homeButton" id="logoutButton">Logout</a>
	  <a href="portfolio.html" onclick="goPortfolio()" class="homeButton"id="portfolioPageButton">Portfolio</a>
	  <a href="favorites.html" onclick="goFavorites()" class="homeButton border" id="favoriteButton">Favorites</a>
	  <a href="index.html" onclick="goHome()" class="homeButton" id="homeButton">Home/Search</a>
	  <a class = "logo" onclick="goHome()" href="index.html">SalStocks</a>
	</header>
	
	<br/>
	<br/>
	<br/>
	
	<div id="favoritesDiv"></div>
	
	
	<script>
		window.onload = function () {
			displayFavorites();
	    }
		
		function displayFavorites(){
			var innerCode="";
	    	$.ajax({
	    		url:"GetFavorites",
	    		data:{
	    			user_id:sessionStorage.getItem("user_id")
	    		},
	    		success: function(res){
	    			if(res.error){
	    				document.getElementById("favoritesDiv").innerHTML="";
	    				alert("Currently you don't have any stock in your favorites.")
	    			}else{
	    				for(i=0; i<res.length; i++){
	    					var lastStyle="";
			 				var percentStyle="";
			 				var caretSrc="";
	    					
			 				if(res[i].percentChange>=0){
			 					lastStyle = "greenLast";
			 					percentStyle = "greenPercent";
			 					caretSrc="caret-up.png";
			 				}else{
			 					lastStyle = "redLast"
			 					percentStyle = "redPercent";
			 					caretSrc="caret-down.png";
			 				}
	    					
	    					
	    					console.log(res[i]);
	    					
	    					innerCode+= "\
	    					<div onclick= \"openDetails(\'"+res[i].ticker+"\')\" id = \"fav"+i+"\" style=\"border-style:solid; border-color:#F2F2F2; width: 80%; float: middle; margin: auto; font-family: Arial, Helvetica, sans-serif;\">\
	    						<input type=\"image\" class=\"closeFormat\" onclick= \"remove(\'"+res[i].ticker+"\')\" src=\"window-close.svg\"\>\
	    						<br/>\
		    					<text class=\"favTicker\">&nbsp;&nbsp;"+res[i].ticker+"</text>\
		    					<text class=\"space "+lastStyle+"\">"+res[i].last+"</text>\
		    					<br/>\
		    					<br/>\
		    					<br/>\
		    					<text class=\"space "+percentStyle+"\">"+res[i].change+" ("+res[i].percentChange+")%</text>\
		 						<img src=\""+caretSrc+"\" class=\"caret\"\>\
		    					<text class=\"favName\">&nbsp;&nbsp;&nbsp;"+res[i].name+"</text>\
		    					<br/>\
		    					<br/>\
	    					</div>\
	    					<br/>\
	    					<br/>\
	    					"
	    				}
	    			}
	    			document.getElementById("favoritesDiv").innerHTML=innerCode;
	    		}
	    	});
		}
		
		function remove(ticker){
			var user_id = sessionStorage.getItem("user_id");
			$.ajax({
				url:"RemoveFavorite",
				data: {
					ticker: ticker,
					user_id: user_id
				},
				success: function(resp){
					if(resp.removed==="true"){
						displayFavorites();
					}
				}
			});	
		}
		
		function openDetails(ticker){
			sessionStorage.setItem("fromFavorites", ticker);
			location.replace("index.html");
		}
	
	
	
	</script>

</body>
</html>