<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SalStocks</title>
	<link rel="stylesheet" type="text/css" href="search8.css"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<meta name="google-signin-client_id" content="228223616702-qu7s6guoulbl4s4dfmin3cu7l1ntj4d7.apps.googleusercontent.com">
</head>
<body>
	<header class="site-header">
	  <a href="login.html" onclick="goLogin()" class="homeButton border" id="loginPageButton">Login/Sign Up</a>
	  <a href="index.html" class="homeButton" id="homeButton">Home/Search</a>
	  <a class = "logo" onclick="goHome()" href="index.html">SalStocks</a>
	</header>
	
	<br>
	<br>
	<br>
	
	<div class="loginLeft">
		<text class = "loginHeader">Login</text>
		<br>
		<br>
		<form id="loginForm">
			<text class = "loginSubheader">Username</text>
			<br>
			<input type="text" id ="loginUsername" class = "loginTextField" required/>
			<br>
			<br>
			<text class = "loginSubheader">Password</text>
			<br>
			<input type="text" id ="loginPassword" class = "loginTextField" required/>
			<br>
			<br>
			<button  onclick ="login()" class = "loginButton" type="button">
				<img src="login.png" width="20px" height="20px">
				<text class = "loginButtonText">Login</text>
			</button>
			<br>
			<br>
			<div class="g-signin2" data-onsuccess="onSignIn"></div>
			
			
		</form>
	</div>
	
	<div class="loginRight">
		<text class = "loginHeader">Sign Up</text>
		<br>
		<br>
		<form id="signUpHeader">
			<text class = "loginSubheader">Email</text>
			<br>
			<input type="text" id ="signUpEmail" class = "loginTextField" required/>
			<br>
			<br>
			<text class = "loginSubheader">Username</text>
			<br>
			<input type="text" id ="signUpUsername" class = "loginTextField" required/>
			<br>
			<br>
			<text class = "loginSubheader">Password</text>
			<br>
			<input type="text" id ="signUpPassword" class = "loginTextField" required/>
			<br>
			<br>
			<text class = "loginSubheader">Confirm Password</text>
			<br>
			<input type="text" id ="signUpConfirmPassword" class = "loginTextField" required/>
			<br>
			<br>
			<button  onclick ="signUp()" class = "loginButton" type="button">
				<img src="login.png" width="20px" height="20px">
				<text class = "loginButtonText">Create Account</text>
			</button>
		</form>
	</div>
	
	
	
	<script>
		function login(){
			if(document.getElementById("loginUsername").value=="" || document.getElementById("loginPassword").value==""){
				alert("Login Failed: Please enter a Username and Password");
				return;
			}
			
			$.ajax({
				url:"login",
				data: {
					username: document.getElementById("loginUsername").value,
					password: document.getElementById("loginPassword").value
				},
				success: function(res){
					alert(res.message);
					if(res.success){
						sessionStorage.setItem("loggedIn", "true");
						sessionStorage.setItem("user_id", res.user_id);
						location.replace("index.html");
					}
				}
			});
		}
		
		function signUp(){
			//Make sure all fields are filled
			if(document.getElementById("signUpEmail").value=="" || document.getElementById("signUpUsername").value=="" || document.getElementById("signUpPassword").value=="" || document.getElementById("signUpConfirmPassword").value==""){
				alert("Signup Failed: Please enter all required fields");
				return;
			}
			
			//Make sure password matches confirm password
			if(document.getElementById("signUpConfirmPassword").value != document.getElementById("signUpPassword").value){
				alert("Signup Failed: Passwords do not match");
				return;
			}
			
			$.ajax({
				url:"signup",
				data: {
					email: document.getElementById("signUpEmail").value,
					username: document.getElementById("signUpUsername").value,
					password: document.getElementById("signUpPassword").value
				},
				success: function(res){
					console.log(res);
					alert(res.message);
					if(res.success){
						sessionStorage.setItem("loggedIn", "true");
						sessionStorage.setItem("user_id", res.user_id);
						location.replace("index.html");
					}
				}
			});
		}
		
		function onSignIn(googleUser) {
			console.log("Signin");
			var profile = googleUser.getBasicProfile();
			var id_token = googleUser.getAuthResponse().id_token;
			var email = profile.getEmail();
			$.ajax({
				url:"GoogleLogin",
				data: {
					email:email,
					id_token:id_token
				},
				success: function(res){
					console.log(res);
					alert(res.message);
					if(res.success){
						sessionStorage.setItem("loggedIn", "true");
						sessionStorage.setItem("user_id", res.user_id);
						gapi.auth2.getAuthInstance().disconnect().then(function () {
							location.replace("index.html");
					    });
					}
				}
			});
			  
		}

	
	</script>
</body>
</html>
